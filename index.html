<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Juego de Matrices: MisiÃ³n CÃ¡lculo</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    body {font-family:'Orbitron',monospace;background:linear-gradient(135deg,#233a45,#1e344d);color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;}
    .console-box{background:rgba(30,44,60,.96);border:3px solid #00cac9;border-radius:16px;padding:28px 10px;margin-top:30px;max-width:480px;width:96vw;box-shadow:0 0 30px #00cac950;text-align:center;}
    h1{color:#00cac9;margin:0 0 8px 0;text-shadow:0 0 14px #00cac970;}
    h2{color:#ffd966;}
    .score-box{margin:10px 0 3px 0;}
    .progress{height:10px;background:rgba(255,255,255,.11);border-radius:5px;overflow:hidden;margin-bottom:12px;}
    .progress-bar{height:100%;background:linear-gradient(90deg,#00cac9,#ffd966);width:10%;transition:.5s;}
    .mission-title{font-weight:bold;color:#00cac9;}
    .challenge-text{color:#ffd966;}
    .matrix-table{display:inline-block;margin:7px 2px;}
    table{border-collapse:collapse;}
    td{border:1px solid #33ecec;padding:6px 14px;font-size:1.05em;background:rgba(255,255,255,0.13);color:#fff;}
    input{width:40px;height:36px;font-size:1.09em;border-radius:7px;border:2px solid #00cac9;text-align:center;margin:1px 2px;margin-bottom:4px;font-family:inherit;}
    input:focus{outline:none;border-color:#ffd966;box-shadow:0 0 7px #ffd96680;}
    .btn{background:linear-gradient(65deg,#00cac9 60%,#ffd966);color:#003311;border:none;border-radius:8px;padding:11px 23px;font-size:1em;font-weight:bold;cursor:pointer;margin:7px 6px 4px 6px;transition:.26s;font-family:inherit;}
    .btn:disabled{background:#222;color:#aaa;cursor:not-allowed;}
    .btn-hidden{display:none;}
    #feedback{min-height:28px;margin:11px 0 0 0;padding:7px 7px 5px 7px;border-radius:7px;font-weight:bold;}
    .feedback-correct{background:rgba(0,255,153,0.16);color:#00cac9;border:1px solid #00cac9;}
    .feedback-incorrect{background:rgba(255,90,90,0.15);color:#ff8888;border:1px solid #ff8888;}
    .feedback-help{background:rgba(255,217,102,0.16);border:1px solid #ffd966;color:#ffd966;}
    .final-message{background:linear-gradient(65deg,#ffd966,#ff8844);color:#003311;padding:25px 8px 18px 8px;border-radius:15px;margin-top:18px;font-size:1.15em;box-shadow:0 3px 17px #ffd96630;}
    @media(max-width:650px){.console-box{max-width:99vw;padding:12px;}}
  </style>
</head>
<body>
<div class="console-box">
  <h1>ðŸ§© Juego de Matrices: MisiÃ³n CÃ¡lculo</h1>
  <div class="progress"><div class="progress-bar" id="progress"></div></div>
  <div class="score-box" id="score-box"></div>
  <div class="mission-title" id="mission-title"></div>
  <div id="problema"></div>
  <div id="respuesta"></div>
  <button class="btn" id="verificar-btn">Verificar</button>
  <button class="btn btn-hidden" id="siguiente-btn">Siguiente</button>
  <button class="btn" id="pista-btn">ðŸ’¡ Pista</button>
  <div id="feedback"></div>
</div>
<script>
const matrices = {
  A: [[3,2],[1,4]], B: [[2,5],[3,1]],
  C: [[2,1],[3,0],[4,2]],
  D: [[1,2,3],[1,2,3]],
  E: [[2,1],[1,3]],
  F: [[4,3,2],[5,2,6],[1,3,1]]
};
const misiones = [
  {
    titulo:"Suma de matrices",
    problema:`Calcula <b>A+B</b>`,
    matriz1:matrices.A, matriz2:matrices.B,
    tipo:"sumar", pista:"Suma elemento a elemento.",
    respuesta: [[5,7],[4,5]]
  },
  {
    titulo:"Resta de matrices",
    problema:`Calcula <b>A-B</b>`,
    matriz1:matrices.A, matriz2:matrices.B,
    tipo:"restar", pista:"Resta elemento a elemento.",
    respuesta: [[1,-3],[-2,3]]
  },
  {
    titulo:"MultiplicaciÃ³n por escalar",
    problema:`Calcula <b>3C</b>`,
    matriz1:matrices.C, escalar:3,
    tipo:"escalar", pista:"Multiplica todos los elementos por 3.",
    respuesta: [[6,3],[9,0],[12,6]]
  },
  {
    titulo:"MultiplicaciÃ³n de matrices",
    problema:`Calcula <b>AÂ·B</b>`,
    matriz1:matrices.A, matriz2:matrices.B,
    tipo:"multiplicar", pista:"Multiplica filas por columnas.",
    respuesta: [[12,17],[14,9]]      // <= CORREGIDO AQUÃ EL ERROR
  },
  {
    titulo:"Determinante 2x2",
    problema:`Calcula el determinante de <b>E</b>`,
    matriz1:matrices.E, tipo:"det22",
    pista:"Usa la fÃ³rmula ad-bc.",
    respuesta: [5]
  },
  {
    titulo:"Determinante 3x3 (Sarrus)",
    problema:`Calcula el determinante de <b>F</b> usando <em>Regla de Sarrus</em>`,
    matriz1:matrices.F, tipo:"det33", pista:"Suma productos de diagonales principales, resta las secundarias.",
    respuesta: [-35]
  }
];

let misionActual=0, puntaje=0, pistas=0, errores=0;

function mostrarMatriz(matriz){
  let html="<table class='matrix-table'><tbody>";
  for(let f of matriz)
    html+="<tr>"+f.map(x=>`<td>${x}</td>`).join("")+"</tr>";
  html+="</tbody></table>";
  return html;
}
function mostrarInputs(dim1,dim2){
  let html="<table class='matrix-table'><tbody>";
  for(let i=0;i<dim1;i++){
    html+="<tr>";
    for(let j=0;j<dim2;j++){
      html+=`<td><input type="text" id="cell_${i}_${j}" /></td>`;
    }
    html+="</tr>";
  }
  html+="</tbody></table>";
  return html;
}
function cargarMision(){
  if(misionActual>=misiones.length){ mostrarMensajeFinal();return; }
  let mis=misiones[misionActual];
  document.getElementById("mission-title").innerHTML=mis.titulo;
  let prb=`${mis.problema}<br>`;
  if(mis.tipo==="sumar"||mis.tipo==="restar"||mis.tipo==="multiplicar")
    prb+=mostrarMatriz(mis.matriz1)+" + "+mostrarMatriz(mis.matriz2);
  if(mis.tipo==="escalar")
    prb+=`Escalar: <b>${mis.escalar}</b><br>`+mostrarMatriz(mis.matriz1);
  if(mis.tipo==="det22"||mis.tipo==="det33")
    prb+=mostrarMatriz(mis.matriz1);
  document.getElementById("problema").innerHTML=prb;
  if(mis.tipo==="det22"||mis.tipo==="det33")
    document.getElementById("respuesta").innerHTML='<input type="text" id="det_resp" />';
  else
    document.getElementById("respuesta").innerHTML=mostrarInputs(mis.respuesta.length,mis.respuesta[0].length||1);
  document.getElementById("feedback").innerHTML="";
  document.getElementById("verificar-btn").classList.remove("btn-hidden");
  document.getElementById("siguiente-btn").classList.add("btn-hidden");
  document.getElementById("pista-btn").disabled=false;
  actualizarBarra();
  actualizarScore();
  setTimeout(()=>{let i=document.querySelector("input");if(i)i.focus();},100);
}
function actualizarBarra(){
  document.getElementById("progress").style.width=(100*(misionActual)/misiones.length)+"%";
}
function actualizarScore(){
  document.getElementById("score-box").innerText=`Puntaje: ${puntaje} | Errores: ${errores} | Pistas: ${pistas}`;
}
function verificarRespuesta(){
  let mis=misiones[misionActual], ok=false;
  if(mis.tipo==="det22"||mis.tipo==="det33"){
    let val = parseInt((document.getElementById("det_resp").value||"0").replace(" ",""));
    ok = (val===mis.respuesta[0]);
  }else{
    ok=true;
    for(let i=0;i<mis.respuesta.length;i++){
      for(let j=0;j<mis.respuesta[0].length;j++){
        let v = (document.getElementById(`cell_${i}_${j}`).value||"").replace(" ","");
        if(parseInt(v)!=mis.respuesta[i][j]) ok=false;
      }
    }
  }
  let fb = document.getElementById("feedback");
  if(ok){
    puntaje++; fb.innerHTML="Â¡Correcto!"; fb.className="feedback-correct";
    document.getElementById("verificar-btn").classList.add("btn-hidden");
    document.getElementById("siguiente-btn").classList.remove("btn-hidden");
    document.getElementById("pista-btn").disabled=true;
  }else{
    errores++; fb.innerHTML="No es correcto. Revisa tu cÃ¡lculo."; fb.className="feedback-incorrect";
  }
  actualizarScore();
}
function siguienteMision(){misionActual++; cargarMision();}
document.getElementById("verificar-btn").onclick=verificarRespuesta;
document.getElementById("siguiente-btn").onclick=siguienteMision;
document.getElementById("pista-btn").onclick=function(){
  pistas++;document.getElementById("feedback").innerHTML="PISTA: "+misiones[misionActual].pista;
  document.getElementById("feedback").className="feedback-help"; this.disabled=true; actualizarScore();
};
document.addEventListener("keydown",function(ev){
  if(ev.key==="Enter"){
    if(!document.getElementById("verificar-btn").classList.contains("btn-hidden")) verificarRespuesta()
    else if(!document.getElementById("siguiente-btn").classList.contains("btn-hidden")) siguienteMision();
  }
});
function mostrarMensajeFinal(){
  document.getElementById("problema").innerHTML=
    `<div class="final-message">
      <h2>ðŸŽ‰ Â¡Enhorabuena, MisiÃ³n MatrÃ­z Superada!</h2>
      <p>Puntaje final: <b>${puntaje}</b> <br> Errores: <b>${errores}</b> <br> Pistas usadas: <b>${pistas}</b></p>
      <ul style="text-align:left;margin:13px 0;list-style:none;">
        <li>âœ… Suma y Resta de Matrices</li>
        <li>âœ… MultiplicaciÃ³n por Escalar</li>
        <li>âœ… MultiplicaciÃ³n de Matrices</li>
        <li>âœ… Determinante 2x2</li>
        <li>âœ… Determinante 3x3 (Sarrus)</li>
      </ul>
      <p><strong>Â¿Vuelves a jugar para mejorar tu resultado?</strong></p>
      <button class='btn' onclick='window.location.reload()'>Reiniciar Juego</button>
    </div>`;
  document.getElementById("respuesta").innerHTML="";
  document.getElementById("feedback").innerHTML="";
  document.getElementById("verificar-btn").classList.add("btn-hidden");
  document.getElementById("siguiente-btn").classList.add("btn-hidden");
  document.getElementById("pista-btn").classList.add("btn-hidden");
  actualizarBarra();
}
cargarMision();
</script>
</body>
</html>
